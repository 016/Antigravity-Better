<!-- Copyright (C) Microsoft Corporation. All rights reserved. -->
<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta http-equiv="Content-Security-Policy" content="
				default-src
					'none'
				;
				img-src
					'self'
					data:
					blob:
					vscode-remote-resource:
					vscode-managed-remote-resource:
					https:
				;
				media-src
					'self'
					data:
					https://127.0.0.1:*
					blob:
					https://www.gstatic.com/
				;
				frame-src
					'self'
					vscode-webview:
					data:
				;
				script-src
					'self'
					'unsafe-eval'
					'unsafe-inline'
					blob:
				;
				style-src
					'self'
					'unsafe-inline'
				;
				connect-src
					'self'
					data:
					http://127.0.0.1:*
					http://jetski-unleash.corp.goog/
					http://antigravity-unleash.goog/
					https:
					ws:
				;
				font-src
					'self'
					vscode-remote-resource:
					vscode-managed-remote-resource:
					https://*.vscode-unpkg.net
				;
				require-trusted-types-for
					'script'
				;
				trusted-types
					amdLoader
					cellRendererEditorText
					collapsedCellPreview
					defaultWorkerFactory
					diffEditorWidget
					diffReview
					domLineBreaksComputer
					dompurify
					dompurifyMermaid
					editorGhostText
					editorViewLayer
					mermaid
					notebookRenderer
					stickyScrollViewLayer
					tokenizeToString
					notebookChatEditController
					richScreenReaderContent
					renderCodeBlock
					antigravityBetter
				;
		" />

	<!-- Workbench CSS -->
	<link rel="stylesheet" href="../../../workbench/workbench.desktop.main.css">

	<style>
		/* ===== Antigravity Better v0.2.1 - æœ€å°éªŒè¯ç‰ˆæœ¬ ===== */

		/* --- è‡ªå®šä¹‰é¢œè‰²å˜é‡ --- */
		:root {
			--color-user-message: #60A5FA;
			--color-ai-response: #E0E0E0;
			--color-code-block: #A78BFA;
			--color-action-status: #4ADE80;
			--color-thinking: #9CA3AF;
			--bg-modal: #1e1e1e;
			--border-color: #3c3c3c;
			--accent-color: #667eea;
			--text-main: #fff;
			--text-sub: #999;
		}

		/* --- æ‚¬æµ®æŒ‰é’® (å®šä½åœ¨ AI é¢æ¿å†…) --- */
		/* æ³¨: .antigravity-agent-side-panel å·²æœ‰ position:absolute, æ— éœ€é¢å¤–è®¾ç½® */
		#ab-settings-btn {
			position: absolute;
			right: 0;
			top: 66%;
			transform: translateY(-50%);
			width: 28px;
			height: 48px;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			border: none;
			border-radius: 8px 0 0 8px;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			box-shadow: -2px 2px 8px rgba(0, 0, 0, 0.3);
			z-index: 9999;
			transition: all 0.3s ease;
		}
		#ab-settings-btn:hover {
			width: 36px;
			background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
		}
		#ab-settings-btn svg {
			width: 18px;
			height: 18px;
			fill: white;
			transition: transform 0.3s ease;
		}
		#ab-settings-btn:hover svg {
			transform: rotate(90deg);
		}

		/* --- å¼¹çª—é®ç½©å±‚ (å®šä½åœ¨ AI é¢æ¿å†…) --- */
		#ab-overlay {
			position: absolute;
			top: 0; left: 0; right: 0; bottom: 0;
			background: rgba(0, 0, 0, 0.5);
			z-index: 10000;
			display: none;
			opacity: 0;
			transition: opacity 0.3s ease;
			align-items: center;
			justify-content: center;
		}
		#ab-overlay.show { display: flex; }
		#ab-overlay.visible { opacity: 1; }

		/* --- è®¾ç½®å¼¹çª— --- */
		#ab-modal {
			background: var(--bg-modal);
			border-radius: 12px;
			width: 400px;
			max-width: 90%;
			max-height: 85%;
			display: flex;
			flex-direction: column;
			box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
			border: 1px solid var(--border-color);
			transform: scale(0.9);
			transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
			overflow: hidden;
		}
		#ab-overlay.visible #ab-modal { transform: scale(1); }

		/* å¼¹çª— Header */
		.ab-header {
			padding: 16px 20px;
			border-bottom: 1px solid var(--border-color);
			display: flex;
			justify-content: space-between;
			align-items: center;
			background: rgba(255, 255, 255, 0.02);
		}
		.ab-brand {
			color: var(--text-main);
			font-size: 16px;
			font-weight: 700;
			background: linear-gradient(90deg, #fff, #a5b4fc);
			-webkit-background-clip: text;
			background-clip: text;
			-webkit-text-fill-color: transparent;
		}
		.ab-version {
			font-size: 10px;
			color: var(--text-sub);
			background: rgba(255, 255, 255, 0.1);
			padding: 2px 6px;
			border-radius: 4px;
			margin-left: 8px;
			font-weight: normal;
			-webkit-text-fill-color: var(--text-sub);
		}
		.ab-close {
			background: none;
			border: none;
			color: var(--text-sub);
			font-size: 20px;
			cursor: pointer;
			padding: 0;
			line-height: 1;
			transition: color 0.2s;
		}
		.ab-close:hover { color: var(--text-main); }

		/* å†…å®¹åŒº */
		.ab-body {
			flex: 1;
			overflow-y: auto;
			padding: 16px 20px;
		}

		/* è®¾ç½®é¡¹ */
		.ab-setting {
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 8px 0;
			border-bottom: 1px solid rgba(255, 255, 255, 0.05);
		}
		.ab-setting:last-child { border-bottom: none; }
		.ab-setting-name {
			color: #ccc;
			font-size: 13px;
			display: flex;
			align-items: center;
			gap: 8px;
		}
		.ab-setting-right {
			display: flex;
			align-items: center;
			gap: 8px;
		}

		/* ä¸»å¼€å…³é«˜äº® */
		.ab-main-toggle {
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 10px 12px;
			background: rgba(102, 126, 234, 0.1);
			border: 1px solid rgba(102, 126, 234, 0.2);
			border-radius: 8px;
			margin-bottom: 12px;
		}
		.ab-main-toggle-label {
			color: var(--text-main);
			font-size: 13px;
			font-weight: 500;
		}

		/* Toggle Switch */
		.ab-toggle {
			position: relative;
			width: 32px;
			height: 18px;
		}
		.ab-toggle input {
			opacity: 0;
			width: 0;
			height: 0;
		}
		.ab-toggle-slider {
			position: absolute;
			cursor: pointer;
			top: 0; left: 0; right: 0; bottom: 0;
			background-color: #3c3c3c;
			transition: 0.3s;
			border-radius: 20px;
		}
		.ab-toggle-slider:before {
			position: absolute;
			content: "";
			height: 12px;
			width: 12px;
			left: 3px;
			bottom: 3px;
			background-color: white;
			transition: 0.3s;
			border-radius: 50%;
		}
		.ab-toggle input:checked + .ab-toggle-slider {
			background: var(--accent-color);
		}
		.ab-toggle input:checked + .ab-toggle-slider:before {
			transform: translateX(14px);
		}

		/* Color Input */
		.ab-color-input {
			width: 24px;
			height: 24px;
			border: 1px solid var(--border-color);
			border-radius: 4px;
			cursor: pointer;
			padding: 0;
			background: none;
		}
		.ab-color-input::-webkit-color-swatch-wrapper { padding: 2px; }
		.ab-color-input::-webkit-color-swatch { border-radius: 2px; border: none; }

		/* åŒºå—æ ‡é¢˜ */
		.ab-section-title {
			font-size: 13px;
			font-weight: 600;
			color: var(--text-main);
			margin: 16px 0 8px;
			display: flex;
			align-items: center;
			gap: 6px;
		}
		.ab-section-title:first-child { margin-top: 0; }

		/* Toast æç¤º */
		#ab-toast {
			position: fixed;
			top: 50px;
			left: 50%;
			transform: translateX(-50%);
			background: rgba(0, 0, 0, 0.85);
			color: white;
			padding: 10px 20px;
			border-radius: 20px;
			font-size: 13px;
			z-index: 20000;
			display: none;
			opacity: 0;
			transition: opacity 0.3s ease, top 0.3s ease;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
			border: 1px solid rgba(255, 255, 255, 0.1);
		}
		#ab-toast.show { display: block; opacity: 1; top: 60px; }

		/* éªŒè¯çŠ¶æ€é¢æ¿ */
		.ab-verify-panel {
			margin-top: 16px;
			padding: 12px;
			background: rgba(0, 0, 0, 0.2);
			border-radius: 8px;
			font-size: 12px;
		}
		.ab-verify-item {
			display: flex;
			align-items: center;
			gap: 8px;
			padding: 4px 0;
			color: #ccc;
		}
		.ab-verify-pass { color: #4ADE80; }
		.ab-verify-fail { color: #f87171; }

		/* ===== é¢œè‰²è¦†ç›–æ ·å¼ ===== */
		/* V0.2: .prose â†’ .leading-relaxed.select-text */
		/* V0.2: #react-app â†’ body + .antigravity-agent-side-panel */

		/* ç”¨æˆ·æ¶ˆæ¯ */
		body.color-user-message .antigravity-agent-side-panel .bg-gray-500\/15 .whitespace-pre-wrap,
		body.color-user-message .antigravity-agent-side-panel .bg-gray-500\/15 [style*="word-break"] {
			color: var(--color-user-message) !important;
		}

		/* AIå›å¤ (æ’é™¤æ€è€ƒåŒºåŸŸ) */
		body.color-ai-response .antigravity-agent-side-panel .leading-relaxed.select-text:not(.opacity-70) p,
		body.color-ai-response .antigravity-agent-side-panel .leading-relaxed.select-text:not(.opacity-70) li,
		body.color-ai-response .antigravity-agent-side-panel .leading-relaxed.select-text:not(.opacity-70) h1,
		body.color-ai-response .antigravity-agent-side-panel .leading-relaxed.select-text:not(.opacity-70) h2,
		body.color-ai-response .antigravity-agent-side-panel .leading-relaxed.select-text:not(.opacity-70) h3,
		body.color-ai-response .antigravity-agent-side-panel .leading-relaxed.select-text:not(.opacity-70) h4,
		body.color-ai-response .antigravity-agent-side-panel .leading-relaxed.select-text:not(.opacity-70) strong,
		body.color-ai-response .antigravity-agent-side-panel .leading-relaxed.select-text:not(.opacity-70) ul,
		body.color-ai-response .antigravity-agent-side-panel .leading-relaxed.select-text:not(.opacity-70) ol,
		body.color-ai-response .antigravity-agent-side-panel .leading-relaxed.select-text:not(.opacity-70) table,
		body.color-ai-response .antigravity-agent-side-panel .leading-relaxed.select-text:not(.opacity-70) th,
		body.color-ai-response .antigravity-agent-side-panel .leading-relaxed.select-text:not(.opacity-70) td {
			color: var(--color-ai-response) !important;
		}

		/* ä»£ç å—ï¼ˆ.leading-relaxed å†…çš„ pre/code + è¡Œå†… codeï¼‰ */
		body.color-code-block .antigravity-agent-side-panel .leading-relaxed pre,
		body.color-code-block .antigravity-agent-side-panel .leading-relaxed pre code,
		body.color-code-block .antigravity-agent-side-panel .leading-relaxed pre span,
		body.color-code-block .antigravity-agent-side-panel .leading-relaxed code.whitespace-pre-wrap {
			color: var(--color-code-block) !important;
		}

		/* æ€è€ƒè¿‡ç¨‹ */
		body.color-thinking .antigravity-agent-side-panel .leading-relaxed.select-text.opacity-70,
		body.color-thinking .antigravity-agent-side-panel .leading-relaxed.select-text.opacity-70 * {
			color: var(--color-thinking) !important;
		}
	</style>
</head>

<body aria-label="">



</body>

<!-- Startup (do not modify order of script tags!) -->
<script src="./workbench.js" type="module"></script>
<script>
(function () {
	'use strict';

	/* ===== Antigravity Better v0.2.1 - æœ€å°éªŒè¯ç‰ˆæœ¬ ===== */
	/* ç›®çš„ï¼šéªŒè¯ä»¥ä¸‹å…³é”®æŠ€æœ¯ç‚¹ */
	/* 1. Trusted Types å…¼å®¹ - åŠ¨æ€ DOM åˆ›å»º */
	/* 2. CSS é€‰æ‹©å™¨é€‚é… - body.xxx .antigravity-agent-side-panel */
	/* 3. MutationObserver - ç›‘å¬ AI é¢æ¿å‡ºç° */
	/* 4. localStorage æ•°æ®æŒä¹…åŒ– */
	/* 5. è®¾ç½®é¢æ¿ UI æ¸²æŸ“ */

	console.log('[AB] Antigravity Better v0.2.1 (Minimal Verification) Loading...');

	// ===== Trusted Types Policy =====
	// workbench.html è¦æ±‚ trusted-typesï¼Œæˆ‘ä»¬åœ¨ CSP ä¸­æ³¨å†Œäº† 'antigravityBetter'
	let abPolicy = null;
	if (window.trustedTypes && trustedTypes.createPolicy) {
		try {
			abPolicy = trustedTypes.createPolicy('antigravityBetter', {
				createHTML: (input) => input
			});
			console.log('[AB] âœ… Trusted Types Policy åˆ›å»ºæˆåŠŸ');
		} catch (e) {
			console.warn('[AB] âš ï¸ Trusted Types Policy åˆ›å»ºå¤±è´¥:', e.message);
		}
	}

	// å®‰å…¨è®¾ç½® innerHTML çš„è¾…åŠ©å‡½æ•°
	function safeSetHTML(el, html) {
		if (abPolicy) {
			el.innerHTML = abPolicy.createHTML(html);
		} else {
			el.innerHTML = html;
		}
	}

	// ===== é…ç½® =====
	const APP_VERSION = '0.2.1-beta';
	const STORAGE_KEY = 'antigravity-better-settings';

	const COLOR_CONFIGS = [
		{ id: 'user-message', cssVar: '--color-user-message', cssClass: 'color-user-message', default: '#60A5FA', enabled: true, icon: 'ğŸ“', labelZh: 'ç”¨æˆ·æ¶ˆæ¯', labelEn: 'User Message' },
		{ id: 'ai-response', cssVar: '--color-ai-response', cssClass: 'color-ai-response', default: '#E0E0E0', enabled: true, icon: 'ğŸ¤–', labelZh: 'AIå›å¤', labelEn: 'AI Response' },
		{ id: 'code-block', cssVar: '--color-code-block', cssClass: 'color-code-block', default: '#A78BFA', enabled: true, icon: 'ğŸ’»', labelZh: 'ä»£ç å—', labelEn: 'Code Block' },
		{ id: 'thinking', cssVar: '--color-thinking', cssClass: 'color-thinking', default: '#9CA3AF', enabled: false, icon: 'ğŸ’­', labelZh: 'æ€è€ƒè¿‡ç¨‹', labelEn: 'Thinking' },
	];

	const defaultSettings = {
		lang: 'zh',
		masterEnabled: false,
		colors: COLOR_CONFIGS.reduce((acc, c) => { acc[c.id] = { color: c.default, enabled: c.enabled }; return acc; }, {}),
	};

	// ===== å­˜å‚¨ =====
	function loadSettings() {
		try {
			const saved = localStorage.getItem(STORAGE_KEY);
			if (saved) {
				const parsed = JSON.parse(saved);
				return {
					lang: parsed.lang ?? defaultSettings.lang,
					masterEnabled: parsed.masterEnabled ?? defaultSettings.masterEnabled,
					colors: { ...defaultSettings.colors, ...parsed.colors },
				};
			}
		} catch (e) { /* ignore */ }
		return { ...defaultSettings };
	}

	function saveSettings(s) {
		try { localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); } catch (e) { /* ignore */ }
	}

	let currentSettings = loadSettings();

	// ===== éªŒè¯ç»“æœ =====
	const verifyResults = {};

	// ===== åº”ç”¨é¢œè‰²è®¾ç½® =====
	function applyColorSettings() {
		COLOR_CONFIGS.forEach(config => {
			const colorSetting = currentSettings.colors[config.id];
			document.documentElement.style.setProperty(config.cssVar, colorSetting.color);
			if (currentSettings.masterEnabled && colorSetting.enabled) {
				document.body.classList.add(config.cssClass);
			} else {
				document.body.classList.remove(config.cssClass);
			}
		});
	}

	// ===== åŠ¨æ€åˆ›å»ºè®¾ç½®é¢æ¿ UI =====
	function createSettingsUI(panelEl) {
		// é¿å…é‡å¤åˆ›å»º
		if (panelEl.querySelector('#ab-settings-btn')) return;

		// --- æ‚¬æµ®æŒ‰é’® ---
		const btn = document.createElement('button');
		btn.id = 'ab-settings-btn';
		btn.title = 'Antigravity Better Settings';
		const svgNS = 'http://www.w3.org/2000/svg';
		const svg = document.createElementNS(svgNS, 'svg');
		svg.setAttribute('viewBox', '0 0 24 24');
		const path = document.createElementNS(svgNS, 'path');
		path.setAttribute('d', 'M19.14,12.94c0.04-0.31,0.06-0.63,0.06-0.94c0-0.31-0.02-0.63-0.06-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.37,4.8,11.69,4.8,12s0.02,0.63,0.06,0.94l-2.03,1.58c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z');
		svg.appendChild(path);
		btn.appendChild(svg);
		panelEl.appendChild(btn);
		verifyResults['DOMåˆ›å»º'] = 'âœ…';
		console.log('[AB] âœ… æ‚¬æµ®æŒ‰é’®åˆ›å»ºæˆåŠŸ (æŒ‚è½½åˆ° AI é¢æ¿)');

		// --- é®ç½©å±‚ ---
		const overlay = document.createElement('div');
		overlay.id = 'ab-overlay';

		// --- å¼¹çª— ---
		const modal = document.createElement('div');
		modal.id = 'ab-modal';

		// Header
		const header = document.createElement('div');
		header.className = 'ab-header';
		const brandSpan = document.createElement('span');
		brandSpan.className = 'ab-brand';
		brandSpan.textContent = 'Antigravity Better';
		const versionSpan = document.createElement('span');
		versionSpan.className = 'ab-version';
		versionSpan.textContent = 'v' + APP_VERSION;
		brandSpan.appendChild(versionSpan);
		const closeBtn = document.createElement('button');
		closeBtn.className = 'ab-close';
		closeBtn.textContent = 'Ã—';
		header.appendChild(brandSpan);
		header.appendChild(closeBtn);
		modal.appendChild(header);

		// Body
		const body = document.createElement('div');
		body.className = 'ab-body';

		// é¢œè‰²åŒºå—æ ‡é¢˜
		const colorTitle = document.createElement('div');
		colorTitle.className = 'ab-section-title';
		colorTitle.textContent = 'ğŸ¨ é¢œè‰²è‡ªå®šä¹‰';
		body.appendChild(colorTitle);

		// ä¸»å¼€å…³
		const mainToggle = createMainToggle('å¯ç”¨è‡ªå®šä¹‰é¢œè‰²', 'Enable Custom Colors', currentSettings.masterEnabled, (checked) => {
			currentSettings.masterEnabled = checked;
			saveSettings(currentSettings);
			applyColorSettings();
		});
		body.appendChild(mainToggle);

		// é¢œè‰²è®¾ç½®é¡¹
		COLOR_CONFIGS.forEach(config => {
			const colorSetting = currentSettings.colors[config.id];
			const item = document.createElement('div');
			item.className = 'ab-setting';

			const nameDiv = document.createElement('div');
			nameDiv.className = 'ab-setting-name';
			nameDiv.textContent = config.icon + ' ' + (currentSettings.lang === 'zh' ? config.labelZh : config.labelEn);

			const rightDiv = document.createElement('div');
			rightDiv.className = 'ab-setting-right';

			const toggle = createToggle(colorSetting.enabled, (checked) => {
				currentSettings.colors[config.id].enabled = checked;
				saveSettings(currentSettings);
				applyColorSettings();
			});
			rightDiv.appendChild(toggle);

			const colorInput = document.createElement('input');
			colorInput.type = 'color';
			colorInput.className = 'ab-color-input';
			colorInput.value = colorSetting.color;
			colorInput.addEventListener('input', () => {
				currentSettings.colors[config.id].color = colorInput.value;
				saveSettings(currentSettings);
				applyColorSettings();
			});
			rightDiv.appendChild(colorInput);

			item.appendChild(nameDiv);
			item.appendChild(rightDiv);
			body.appendChild(item);
		});

		// éªŒè¯é¢æ¿
		const verifyTitle = document.createElement('div');
		verifyTitle.className = 'ab-section-title';
		verifyTitle.textContent = 'ğŸ” æŠ€æœ¯éªŒè¯ç»“æœ';
		verifyTitle.style.marginTop = '20px';
		body.appendChild(verifyTitle);

		const verifyPanel = document.createElement('div');
		verifyPanel.className = 'ab-verify-panel';
		verifyPanel.id = 'ab-verify-panel';
		body.appendChild(verifyPanel);

		modal.appendChild(body);
		overlay.appendChild(modal);
		panelEl.appendChild(overlay);

		// --- äº‹ä»¶ç»‘å®š ---
		btn.addEventListener('click', () => {
			overlay.classList.add('show');
			requestAnimationFrame(() => overlay.classList.add('visible'));
			updateVerifyPanel();
		});
		closeBtn.addEventListener('click', closeModal);
		overlay.addEventListener('click', (e) => { if (e.target === overlay) closeModal(); });

		function closeModal() {
			overlay.classList.remove('visible');
			setTimeout(() => overlay.classList.remove('show'), 300);
		}

		console.log('[AB] âœ… è®¾ç½®é¢æ¿åˆ›å»ºæˆåŠŸ');
	}

	// åˆ›å»º Toggle å¼€å…³
	function createToggle(checked, onChange) {
		const label = document.createElement('label');
		label.className = 'ab-toggle';
		const input = document.createElement('input');
		input.type = 'checkbox';
		input.checked = checked;
		input.addEventListener('change', () => onChange(input.checked));
		const slider = document.createElement('span');
		slider.className = 'ab-toggle-slider';
		label.appendChild(input);
		label.appendChild(slider);
		return label;
	}

	// åˆ›å»ºä¸»å¼€å…³
	function createMainToggle(zhLabel, enLabel, checked, onChange) {
		const wrapper = document.createElement('div');
		wrapper.className = 'ab-main-toggle';
		const label = document.createElement('span');
		label.className = 'ab-main-toggle-label';
		label.textContent = currentSettings.lang === 'zh' ? zhLabel : enLabel;
		const toggle = createToggle(checked, onChange);
		wrapper.appendChild(label);
		wrapper.appendChild(toggle);
		return wrapper;
	}

	// æ›´æ–°éªŒè¯é¢æ¿
	function updateVerifyPanel() {
		const panel = document.getElementById('ab-verify-panel');
		if (!panel) return;
		while (panel.firstChild) panel.removeChild(panel.firstChild);

		const checks = [
			{ name: 'Trusted Types Policy', result: abPolicy ? 'âœ… å·²åˆ›å»º' : 'âš ï¸ æœªåˆ›å»ºï¼ˆéå¿…é¡»ï¼‰' },
			{ name: 'DOM åŠ¨æ€åˆ›å»º', result: verifyResults['DOMåˆ›å»º'] || 'âŒ å¤±è´¥' },
			{ name: 'localStorage è¯»å†™', result: testLocalStorage() },
			{ name: 'CSS å˜é‡æ³¨å…¥', result: testCSSVariable() },
			{ name: 'AI é¢æ¿æ£€æµ‹', result: verifyResults['AIé¢æ¿'] || 'âŒ æœªæ‰¾åˆ°' },
			{ name: 'SafeHTML (innerHTML)', result: testSafeHTML() },
			{ name: 'é¢æ¿å†…å®šä½', result: 'âœ… å·²æŒ‚è½½åˆ° AI é¢æ¿' },
		];

		checks.forEach(check => {
			const item = document.createElement('div');
			item.className = 'ab-verify-item';
			const isPass = check.result.startsWith('âœ…');
			item.classList.add(isPass ? 'ab-verify-pass' : 'ab-verify-fail');
			item.textContent = check.result + ' ' + check.name;
			panel.appendChild(item);
		});
	}

	// ===== éªŒè¯å‡½æ•° =====
	function testLocalStorage() {
		try {
			localStorage.setItem('ab-test', 'ok');
			const val = localStorage.getItem('ab-test');
			localStorage.removeItem('ab-test');
			return val === 'ok' ? 'âœ…' : 'âŒ';
		} catch (e) {
			return 'âŒ ' + e.message;
		}
	}

	function testCSSVariable() {
		const val = getComputedStyle(document.documentElement).getPropertyValue('--color-user-message').trim();
		return val ? 'âœ…' : 'âŒ å˜é‡æœªç”Ÿæ•ˆ';
	}

	function testSafeHTML() {
		try {
			const testEl = document.createElement('span');
			safeSetHTML(testEl, '<b>test</b>');
			const result = testEl.querySelector('b') ? 'âœ…' : 'âŒ';
			return result;
		} catch (e) {
			return 'âŒ ' + e.message;
		}
	}

	// ===== ç­‰å¾… AI é¢æ¿å‡ºç° â†’ åˆå§‹åŒ– UI =====
	function onPanelReady(panelEl) {
		console.log('[AB] âœ… AI é¢æ¿å·²æ£€æµ‹åˆ°');
		verifyResults['AIé¢æ¿'] = 'âœ…';
		createSettingsUI(panelEl);
		applyColorSettings();
	}

	function waitForAgentPanel() {
		const panel = document.querySelector('.antigravity-agent-side-panel');
		if (panel) {
			onPanelReady(panel);
			return;
		}

		const observer = new MutationObserver((mutations, obs) => {
			const panel = document.querySelector('.antigravity-agent-side-panel');
			if (panel) {
				obs.disconnect();
				onPanelReady(panel);
			}
		});
		observer.observe(document.body, { childList: true, subtree: true });
		console.log('[AB] â³ ç­‰å¾… AI é¢æ¿å‡ºç°...');
	}

	// ===== åˆå§‹åŒ– =====
	function init() {
		console.log('[AB] å¼€å§‹åˆå§‹åŒ–...');
		try {
			applyColorSettings();
			waitForAgentPanel();
			console.log('[AB] âœ… åˆå§‹åŒ–å®Œæˆï¼Œç­‰å¾… AI é¢æ¿...');
		} catch (e) {
			console.error('[AB] âŒ åˆå§‹åŒ–å¤±è´¥:', e);
		}
	}

	// ç­‰å¾… body å°±ç»ªååˆå§‹åŒ–
	if (document.body) {
		setTimeout(init, 1000);
	} else {
		document.addEventListener('DOMContentLoaded', () => setTimeout(init, 1000));
	}
})();
</script>

</html>